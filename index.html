<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SnapLogic Sizing Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: auto;
            padding: 20px;
            background-color: #f4f4f9;
            color: #333;
        }
        h1, h2 {
            text-align: center;
            color: #0056b3;
        }
        p {
            text-align: center;
            color: #555;
        }
        label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
        }
        input[type="number"], select {
			width: 100%;
			padding: 10px;
			margin-bottom: 10px;
			border: 1px solid #ccc;
			border-radius: 5px;
			background-color: #fff;
			appearance: none;
			-webkit-appearance: none;
			-moz-appearance: none;
			background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24"><path fill="none" stroke="black" stroke-width="2" d="M2 7 L12 17 L22 7 Z"/></svg>');
			background-repeat: no-repeat;
			background-position: right 10px center;
			background-size: 10px 10px;
			font-size: 16px;
			cursor: pointer;
		}

		select:focus {
			border-color: #0056b3;
			box-shadow: 0 0 5px rgba(0, 86, 179, 0.5);
			outline: none;
		}

		select option {
			height: 38px; /* Assuming the select field height is around 38px */
			padding: 10px;
			background-color: #fff;
			color: #333;
			display: flex;
			align-items: center;
		}

		select option:hover {
			background-color: #f4f4f9;
			color: #0056b3;
		}


        button {
            width: 100%;
            padding: 10px;
            background-color: #0056b3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #003d80;
        }
        .result {
            background: #f7f7f7;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .info {
            color: #0056b3;
            font-style: italic;
            margin-top: 10px;
        }
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background: #ddd;
            border: 1px solid #ccc;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
        }
        .tab.active {
            background: #fff;
            font-weight: bold;
            color: #0056b3;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            background: #fff;
            border: 1px solid #ccc;
            padding: 20px;
            border-radius: 0 5px 5px 5px;
        }
        .toggle-container {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        .toggle-label {
            margin-right: 10px;
        }
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #0056b3;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        footer {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #777;
        }
        footer a {
            color: #0056b3;
            text-decoration: none;
        }
        footer a:hover {
            text-decoration: underline;
        }
        .logo {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .logo img {
            width: 200px;
            cursor: pointer;
        }
        .popup {
            display: none;
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 5px;
            z-index: 1000;
        }
        .popup input[type="password"] {
            width: calc(100% - 22px);
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .popup button {
            width: 100%;
            padding: 10px;
            background-color: #0056b3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .popup button:hover {
            background-color: #003d80;
        }
        .overlay {
            display: none;
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
    </style>
</head>
<body>
    <div class="logo" onclick="showPopup()">
        <img src="https://www.snaplogic.com/wp-content/uploads/2022/09/SL_logo_blue_web.png" alt="SnapLogic Logo">
    </div>

    <h1>Node Sizing Calculator</h1>
    <p>Use this calculator to estimate the number of nodes required for various SnapLogic tasks. 
    The formulas are based on the <a href="https://community.snaplogic.com/t5/sigma-framework-library/snaplex-capacity-tuning-guide/td-p/23787" target="_blank">Sigma Framework Capacity Guide</a>.</p>

    <div class="tabs">
        <div class="tab active" onclick="openTab(event, 'tab1')">Triggered Task</div>
        <div class="tab" onclick="openTab(event, 'tab2')">Ultra Task</div>
        <div class="tab" onclick="openTab(event, 'tab3')">Scheduled Task</div>
    </div>

    <div id="tab1" class="tab-content active">
        <p>This calculator helps in sizing for triggered tasks with the assumption of an average execution time of 1 second.</p>

        <form id="calculator-form">
            <label for="api-per-year">API requests per year</label>
            <input type="number" id="api-per-year" value="300000000">

            <label for="coverage-days">API Usage Days per Month</label>
            <input type="number" id="coverage-days" value="30">

            <label for="coverage-hours">API Usage Hours per Day</label>
            <input type="number" id="coverage-hours" value="24">

            <label for="api-response-time" id="api-response-time-label" style="display: none;">API Response Time (seconds)</label>
            <input type="number" id="api-response-time" value="1" style="display: none;">

            <label for="peak">Peak (%)</label>
            <input type="number" id="peak" value="150">

            <button type="button" onclick="calculate()">Calculate</button>
        </form>

        <div class="result" id="result"></div>
    </div>

    <div id="tab2" class="tab-content">
        <p>This calculator helps in sizing for ultra tasks with the assumption of an average execution time of 0.3 seconds.</p>

        <form id="calculator-form-ultra">
            <label for="api-per-year-ultra">API requests per year</label>
            <input type="number" id="api-per-year-ultra" value="100000000">

            <label for="coverage-days-ultra">API Usage Days per Month</label>
            <input type="number" id="coverage-days-ultra" value="20">

            <label for="coverage-hours-ultra">API Usage Hours per Day</label>
            <input type="number" id="coverage-hours-ultra" value="12">

            <label for="api-response-time-ultra" id="api-response-time-label-ultra" style="display: none;">API Response Time (seconds)</label>
            <input type="number" id="api-response-time-ultra" value="0.3" style="display: none;">

            <label for="peak-ultra">Peak (%)</label>
            <input type="number" id="peak-ultra" value="150">

            <button type="button" onclick="calculateUltra()">Calculate</button>
        </form>

        <div class="result" id="result-ultra"></div>
    </div>

    <div id="tab3" class="tab-content">
        <p>This calculator helps in sizing for scheduled tasks. Specific patterns and bulk load snaps can bring even greater performance, but this calculator provides a good average expectation.</p>
        <form id="calculator-form-scheduled">
            <label for="batch-size" id="batch-size-label" class="toggle-label">Batch size (Gb)</label>
            <input type="number" id="batch-size" value="300">
            <div class="toggle-container">
                <label for="toggle-switch" class="toggle-label">Toggle to Batch volume (Rows)</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggle-switch" onclick="toggleBatchMode()">
                    <span class="slider"></span>
                </label>
            </div>

            <label for="process-time">Available Batch Window (hours)</label>
            <input type="number" id="process-time" value="12">

            <label for="complexity-multiplier" id="complexity-multiplier-label" style="display: none;">Transformation Complexity</label>
			<select id="complexity-multiplier" style="display: none;">
				<option value="1" selected>straight pass through</option>
				<option value="1.25">few sorts/aggregations</option>
				<option value="1.5">moderate sorts/aggregations</option>
				<option value="2">many sorts/aggregations</option>
			</select>

            <button type="button" onclick="calculateScheduled()">Calculate</button>
        </form>

        <div class="result" id="result-scheduled"></div>
    </div>

    <div class="popup" id="popup">
        <h2>Enter Password</h2>
        <input type="password" id="password" placeholder="Password">
        <button type="button" onclick="checkPassword()">Submit</button>
    </div>
    <div class="overlay" id="overlay" onclick="hidePopup()"></div>

    <script>
        let isBatchSize = true;

        function openTab(event, tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));

            event.currentTarget.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function calculate() {
            // Get input values
            const apiPerYear = document.getElementById('api-per-year').value;
            const coverageDays = document.getElementById('coverage-days').value;
            const coverageHours = document.getElementById('coverage-hours').value;
            const peak = document.getElementById('peak').value;
            const apiExecutionTime = document.getElementById('api-response-time').value;

            // Perform calculations
            const concurrentAPI = apiPerYear / 12 / coverageDays / coverageHours / 60 / 60 * (peak / 100);
            const nodesRequired = concurrentAPI / (20 / apiExecutionTime);
            const haNodesRequired = Math.ceil(Math.max(nodesRequired * 1.3, 2));

            // Display results
            let resultHTML = `
                <h2>Results</h2>
                <p>Concurrent API: ${concurrentAPI.toFixed(2)}</p>
                <p>Nodes Required: ${nodesRequired.toFixed(2)}</p>
                <p>HA Nodes Required: ${haNodesRequired.toFixed(2)}</p>
            `;

            if (haNodesRequired > 6) {
                resultHTML += `
                    <p class="info">
                        Consider looking into <a href="https://www.snaplogic.com/resources/data-sheets/snaplogic-ultra-pipelines" target="_blank">SnapLogic Ultra Pipeline</a> for better performance.
                    </p>
                `;
            }

            document.getElementById('result').innerHTML = resultHTML;
        }

        function calculateUltra() {
            // Get input values
            const apiPerYear = document.getElementById('api-per-year-ultra').value;
            const coverageDays = document.getElementById('coverage-days-ultra').value;
            const coverageHours = document.getElementById('coverage-hours-ultra').value;
            const peak = document.getElementById('peak-ultra').value;
            const apiExecutionTime = document.getElementById('api-response-time-ultra').value;

            // Perform calculations
            const concurrentAPI = apiPerYear / 12 / coverageDays / coverageHours / 60 / 60 * (peak / 100);
            const nodesRequired = concurrentAPI / (200 / apiExecutionTime);
            const haNodesRequired = Math.max(Math.ceil(nodesRequired * 1.3), 2);
            const fmNodesRequired = concurrentAPI / (400 / apiExecutionTime);
            const haFmNodesRequired = Math.max(Math.ceil(fmNodesRequired * 1.3), 2);

            // Display results
            document.getElementById('result-ultra').innerHTML = `
                <h2>Results</h2>
                <p>API per second: ${concurrentAPI.toFixed(2)}</p>
                <p>Execution Nodes Required: ${nodesRequired.toFixed(2)}</p>
                <p>FeedMaster Nodes Required: ${fmNodesRequired.toFixed(2)}</p>
                <p>HA Execution Nodes Required: ${haNodesRequired.toFixed(2)}</p>
                <p>HA FeedMaster Nodes Required: ${haFmNodesRequired.toFixed(2)}</p>
            `;
        }

        function toggleBatchMode() {
            const label = document.getElementById('batch-size-label');
            const input = document.getElementById('batch-size');

            if (isBatchSize) {
                label.textContent = 'Batch volume (Rows)';
                input.value = 1500000000; // Default value for rows
                isBatchSize = false;
            } else {
                label.textContent = 'Batch size (Gb)';
                input.value = 300; // Default value for Gb
                isBatchSize = true;
            }
        }

        function calculateScheduled() {
            // Get input values
            const batchSizeInput = document.getElementById('batch-size').value;
            const processTime = document.getElementById('process-time').value;
            const complexityMultiplier = document.getElementById('complexity-multiplier').value;
            let batchSize;

            if (isBatchSize) {
                batchSize = batchSizeInput; // In Gb
            } else {
                batchSize = batchSizeInput * 2000 / 10000000000; // Convert rows to Gb
            }

            // Perform calculations
            const mbPerMinute = (batchSize * 1024) / (processTime * 60);
            const nodesRequired = mbPerMinute * complexityMultiplier / 300;
            const haNodesRequired = Math.ceil(Math.max(nodesRequired * 1.3, 2));

            // Display results
            document.getElementById('result-scheduled').innerHTML = `
                <h2>Results</h2>
                <p>Mb per minute: ${mbPerMinute.toFixed(2)}</p>
                <p>Nodes Required: ${nodesRequired.toFixed(2)}</p>
                <p>HA Nodes Required: ${haNodesRequired.toFixed(2)}</p>
            `;
        }

        function showPopup() {
            document.getElementById('popup').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }

        function hidePopup() {
            document.getElementById('popup').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }

        function checkPassword() {
            const password = document.getElementById('password').value;
            if (password === 'snapLogic4snapLogic') {
                document.getElementById('api-response-time-label').style.display = 'block';
                document.getElementById('api-response-time').style.display = 'block';
                document.getElementById('api-response-time-label-ultra').style.display = 'block';
                document.getElementById('api-response-time-ultra').style.display = 'block';
                document.getElementById('complexity-multiplier-label').style.display = 'block';
                document.getElementById('complexity-multiplier').style.display = 'block';
                hidePopup();
            } else {
                alert('Incorrect password. Please try again.');
            }
        }
    </script>
    <footer>
        <p><b>Disclaimer: </b>The SnapLogic Sizing Calculator provides estimations based on user inputs and general assumptions. The results generated by this tool are intended for preliminary planning purposes only and should not be considered as definitive or binding. Actual sizing requirements may vary based on specific use cases, system configurations, workload variations, and other factors not accounted for in this tool. We recommend consulting with a SnapLogic representative or conducting a detailed analysis for precise sizing and configuration.</p>
    </footer>
</body>
</html>
